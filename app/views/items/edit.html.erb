<div class="max-w-4xl mx-auto px-4 py-6">
  <h1 class="text-2xl font-bold mb-6 text-gray-800">商品メモ編集</h1>

  <%= form_with model: @item, local: true, class: "bg-gray-50 p-6 rounded-lg shadow grid grid-cols-1 md:grid-cols-2 gap-6" do |f| %>

    <div class="flex flex-col items-center justify-center bg-gray-100 rounded-lg p-4">
      <% if @item.image.attached? %>
        <%= image_tag @item.image, class: "w-48 h-48 object-cover rounded mb-4" %>
      <% else %>
        <div class="w-48 h-48 flex items-center justify-center bg-gray-200 rounded mb-4 text-gray-500">
          📷 画像を選択
        </div>
      <% end %>
      <%= f.file_field :image, accept: "image/*",
            class: "text-sm text-gray-700 cursor-pointer" %>
    </div>

    <div class="space-y-4">
      <div>
        <%= f.label :title, "商品名", class: "block text-sm font-medium text-gray-700 mb-1" %>
        <%= f.text_field :title, class: "w-full border-gray-300 rounded-md shadow-sm" %>
      </div>

      <div>
  <%= f.label :url, "URL", class: "block text-sm font-medium text-gray-700 mb-1" %>

  <div class="flex items-center">
    <%= f.text_field :url,
      id: "url-input",
      class: "flex-grow border-gray-300 rounded-l-md shadow-sm px-3 py-2 text-sm focus:ring-2 focus:ring-blue-300",
      placeholder: "https://example.com/product" %>

    <button type="button"
      id="clear-url"
      class="bg-gray-100 border border-gray-300 rounded-r-md px-3 py-2 text-sm text-gray-600 hover:bg-gray-200 hover:text-gray-800 transition">
      クリア
    </button>
  </div>

  <p class="text-xs text-gray-500 mt-1">
    リンクが無効になった場合は新しいURLを入力してください
  </p>
</div>

<script>
  document.addEventListener("turbo:load", () => {
    const input = document.getElementById("url-input");
    const clearBtn = document.getElementById("clear-url");

    if (input && clearBtn) {
      clearBtn.addEventListener("click", () => {
        input.value = "";
        input.focus();
      });
    }
  });
</script>


      <div>
        <%= f.label :memo, "メモ（30文字以内）", class: "block text-sm font-medium text-gray-700 mb-1" %>
        <%= f.text_area :memo,
                         rows: 3,
                         maxlength: 30,
                         class: "w-full border-gray-300 rounded-md shadow-sm",
                         placeholder: "メモ（30文字以内）" %>
      </div>

      <div>
        <%= f.label :tag_id, "タグ", class: "block text-sm font-medium text-gray-700 mb-1" %>
        <%= f.collection_select :tag_id,
              current_user.tags, :id, :name,
              { include_blank: "タグなし" },
              class: "w-full border-gray-300 rounded-md shadow-sm" %>
      </div>

      <div>
  <label class="block text-sm font-medium text-gray-700 mb-1">
    新しいタグを作成（任意）
  </label>
  <input type="text" name="new_tag_name"
         class="w-full border-gray-300 rounded-md shadow-sm"
         placeholder="新しいタグ名を入力" >
  <p class="text-xs text-gray-500 mt-1">
    ※ 入力すると上のタグ選択は無視され、新しいタグが自動で作成されます
  </p>
</div>

<%= f.fields_for :reminder do |r| %>
  <%= r.hidden_field :id %>

  <div class="mb-4">
    <%= r.label :scheduled_date, "リマインダー日" %>
    <%= r.date_field :scheduled_date,
    class: "border-2 border-yellow-300 rounded-mb px-3 py-2 focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:border-yellow-500 w-full" %>
  </div>

<% end %>

      <div class="flex justify-between items-center pt-4">
        <%= link_to "← 商品メモ一覧に戻る", items_path,
          class: "px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600" %>

        <%= f.submit "更新する",
          class: "px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700" %>
      </div>
    </div>
  <% end %>
</div>
