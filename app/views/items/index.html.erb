<div class="mx-auto max-w-screen-xl px-4 sm:px-6 lg:px-8">
  <div class="flex items-center justify-between mb-6">
    <h1 class="text-2xl font-bold text-gray-800">
      <%= t('items.index.title')%>
    </h1>

    <%= link_to t('items.index.plan_list'), reminders_items_path,
        class: "bg-yellow-500 hover:bg-yellow-600 text-white font-semibold px-4 py-2 rounded shadow" %>
  </div>

<!-- å…¨ä½“ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼ˆå·¦ï¼šå•†å“ã‚«ãƒ¼ãƒ‰2ã‚«ãƒ©ãƒ  / å³ï¼šã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ï¼‰ -->
  <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">

  <!-- å•†å“ 2ã‚«ãƒ©ãƒ  -->
    <div class="lg:col-span-2">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">

        <% if @items.present? %>
          <% @items.each do |item| %>
            <div class="rounded-xl border border-gray-200 bg-white p-4 shadow hover:shadow-lg transition">

              <div class="flex gap-4">
                <!-- å•†å“ç”»åƒ -->
                <%= link_to (item.url.presence || "#"), target: "_blank", class: "w-32 h-32 flex-shrink-0" do %>
                  <% if item.image.attached? %>
                    <%= image_tag url_for(item.image),
                        class: "rounded-lg w-32 h-32 object-cover" %>
                  <% else %>
                    <%= image_tag "no_image.png",
                      class: "rounded-lg w-32 h-32 object-cover opacity-60" %>
                  <% end %>
                <% end %>

              <!-- å•†å“æƒ…å ± -->
              <div class="flex-1">
                <h2 class="text-lg font-semibold text-blue-700 hover:underline break-words">
                  <%= link_to (item.try(:title).presence || t('items.show.no_title')),
                        (item.url.presence || "#"),
                        target: "_blank" %>
                </h2>

                <p class="text-sm text-gray-600 mt-1 break-all whitespace-normal">
                  <%= t('items.show.memo') %>ï¼š<%= item.try(:memo).presence || t('items.show.no_memo') %>
                </p>

                <p class="text-sm text-gray-600 mt-1">
                  ðŸ“… <%= item.reminder&.scheduled_date&.strftime("%Y-%m-%d") || t('items.show.no_date') %>
                </p>

                <div class="mt-2">
                  <%= link_to t('items.show.details'), item_path(item),
                      class: "text-sm text-gray-500 hover:text-gray-700 underline" %>
                </div>
              </div>
            </div>

          </div>
        <% end %>
      <% else %>
        <p class="text-gray-600 text-center mt-8 col-span-2">
          <%= t('items.index.no_items')%>
        </p>
      <% end %>
    </div>

    <!-- ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ -->
    <div class="mt-6">
      <%= paginate @items %>
    </div>
  </div>

  <!-- ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼-->
  <div class="lg:col-span-1 flex flex-col gap-4 sticky top-4 h-fit">
    <h2 class="text-2xl font-bold text-gray-800">
      <%= t('items.index.calendar')%>
    </h2>

    <!-- æœˆç§»å‹• -->
    <div class="flex items-center justify-between">
      <%= link_to t("items.index.prev_month"),
          url_for(month: @month.prev_month.strftime("%Y-%m")),
          class: "px-3 py-2 rounded-md bg-gray-100 text-gray-800 hover:bg-gray-200 active:scale-95 transition",
          aria: { label: t("items.index.prev_month") } %>

      <div class="font-bold"><%= @month.strftime(I18n.t("items.index.year_month")) %></div>

        <%= link_to t("items.index.next_month"),
            url_for(month: @month.next_month.strftime("%Y-%m")),
            class: "px-3 py-2 rounded-md bg-gray-100 text-gray-800 hover:bg-gray-200 active:scale-95 transition",
            aria: { label: t("items.index.next_month") } %>
      </div>

      <% today = Date.current %>
      <% first_day = @month.beginning_of_month %>
      <% last_day  = @month.end_of_month %>

    <table class="w-full border-collapse text-sm table-fixed bg-white rounded-lg shadow overflow-visible">
      <thead>
        <tr>
          <% I18n.t('items.index.weekdays').each do |day| %>  
            <th class="p-2 bg-gray-200 border text-xs lg:text-sm"><%= day %></th>
          <% end %>
        </tr>
      </thead>
    <tbody>
      <% date = first_day.beginning_of_week(:sunday) %>
      <% end_week = last_day.end_of_week(:sunday) %>

      <% while date <= end_week do %>
        <tr>
          <% 7.times do %>
            <% current = date %>
            <% reminders = @reminder_days[current] %>

            <td class="relative h-14 border align-top p-1
              <%= 'bg-green-200 font-bold' if current == today %>
              <%= 'text-gray-400' if current.month != @month.month %>">

          <%= link_to reminders_by_date_path(date: current), class: "absolute inset-0 block p-1" do %>

      <div class="text-xs font-bold">
        <%= current.day %>
      </div>

    <% if reminders.present? %>
      <div class="mt-1">
        <div class="w-5 h-5 bg-yellow-400 text-center text-xs rounded-full mx-auto">
          <%= reminders.count %>
        </div>
      </div>
    <% end %>

    <!-- é€æ˜Žãƒœã‚¿ãƒ³ -->
    <%= link_to "",
        reminders_by_date_path(date: current),
        class: "absolute inset-0 block p-1 hover:bg-purple-100 rounded-lg transition" %>

    <% end %>
  </td>

            <% date += 1 %>
          <% end %>
        </tr>
      <% end %>
    </tbody>
  </table>

  <!-- æ¥½å¤©ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆåºƒå‘Š -->
  <div class="mt-4 flex justify-center">
    <a href="https://hb.afl.rakuten.co.jp/hsc/4e5f3a8c.91f90091.4e5e0f94.70024a82/?link_type=pict&ut=eyJwYWdlIjoic2hvcCIsInR5cGUiOiJwaWN0IiwiY29sIjoxLCJjYXQiOiIxMTMiLCJiYW4iOjEyNTE4MjAsImFtcCI6ZmFsc2V9" target="_blank" rel="nofollow sponsored noopener" style="word-wrap:break-word;"><img src="https://hbb.afl.rakuten.co.jp/hsb/4e5f3a8c.91f90091.4e5e0f94.70024a82/?me_id=1&me_adv_id=1251820&t=pict" border="0" style="margin:2px" alt="" title=""></a>
  </div>

  <div class="mt-4 flex justify-center">
    <script type="text/javascript">rakuten_design="slide";rakuten_affiliateId="4e5ecbdf.9c1d6718.4e5ecbe1.fe7b9649";rakuten_items="ctsmatch";rakuten_genreId="0";rakuten_size="336x280";rakuten_target="_blank";rakuten_theme="gray";rakuten_border="on";rakuten_auto_mode="on";rakuten_genre_title="off";rakuten_recommend="on";rakuten_ts="1763637497254";</script><script type="text/javascript" src="https://xml.affiliate.rakuten.co.jp/widget/js/rakuten_widget.js?20230106"></script>
  </div>
</div>

<script>
  function togglePopup(id) {
    const popup = document.getElementById('popup-' + id);
    popup.classList.toggle('hidden');
  }
</script>

  </div>
</div>