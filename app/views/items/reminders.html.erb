<div class="flex items-center justify-between mb-6">
  <h1 class="text-2xl font-bold text-gray-800">„É™„Éû„Ç§„É≥„ÉÄ„Éº‰∏ÄË¶ß</h1>
  <div class="mt-10">
    <%= link_to "‚Üê ÂïÜÂìÅ„É°„É¢‰∏ÄË¶ß„Å´Êàª„Çã", items_path,
          class: "px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600" %>
  </div>
</div>


<div class="grid grid-cols-1 lg:grid-cols-3 gap-6">

  <div class="lg:col-span-2">
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">

      <% if @reminders.present? %>
        <% @reminders.each do |reminder| %>
          <div class="rounded-xl border border-gray-200 bg-white p-4 shadow hover:shadow-lg transition">

            <div class="flex gap-4">

              <% if reminder.item %>
                <%= link_to item_path(reminder.item), class: "w-32 h-32 flex-shrink-0" do %>
                  <% if reminder.item.image&.attached? %>
                    <%= image_tag url_for(reminder.item.image),
                        class: "rounded-lg w-32 h-32 object-cover" %>
                  <% else %>
                    <%= image_tag "no_image.png",
                        class: "rounded-lg w-32 h-32 object-cover opacity-60" %>
                  <% end %>
                <% end %>
              <% else %>
                <div class="w-32 h-32 bg-gray-200 rounded-lg flex items-center justify-center">
                  <span class="text-gray-500 text-sm">ÂïÜÂìÅ„Å™„Åó</span>
                </div>
              <% end %>

              <!-- ÊÉÖÂ†± -->
              <div class="flex-1">
                <h2 class="text-lg font-semibold text-blue-700 break-words">
                  <% if reminder.item %>
                    <%= link_to (reminder.item.title || "„Çø„Ç§„Éà„É´„Å™„Åó"), item_path(reminder.item), class: "hover:underline" %>
                  <% else %>
                    (ÂïÜÂìÅ„Å™„Åó)
                  <% end %>
                </h2>

                <p class="text-sm text-gray-600 mt-1">
                  üìÖ <%= reminder.scheduled_date&.strftime("%Y-%m-%d") || "Êó•‰ªò„Å™„Åó" %>
                </p>

                <p class="text-sm text-gray-700 mt-1">
                  „É°„É¢Ôºö<%= reminder.memo.presence || "„É°„É¢„Å™„Åó" %>
                </p>

                <div class="mt-2">
                  <%= link_to "Ë©≥Á¥∞„ÇíË¶ã„Çã", item_path(reminder.item),
                    class: "text-sm text-gray-500 hover:text-gray-700 underline" %>
                </div>

              </div>
            </div>

          </div>
        <% end %>
      <% else %>
        <p class="text-gray-600 text-center mt-8 col-span-2">
          „Åæ„Å†„É™„Éû„Ç§„É≥„ÉÄ„Éº„ÅåÁôªÈå≤„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇ
        </p>
      <% end %>
    </div>

    <!-- „Éö„Éº„Ç∏„Éç„Éº„Ç∑„Éß„É≥ -->
    <div class="mt-6">
      <%= paginate @reminders %>
    </div>
  </div>

  <!-- „Ç´„É¨„É≥„ÉÄ„Éº-->
  <div class="rounded-xl bg-purple-200 p-4 min-h-[400px] shadow-md">
  <h2 class="text-xl font-bold text-purple-900 mb-4">„Ç´„É¨„É≥„ÉÄ„Éº</h2>

  <% today = Date.current %>
  <% first_day = today.beginning_of_month %>
  <% last_day = today.end_of_month %>

  <table class="w-full border-collapse text-sm table-fixed bg-white rounded-lg shadow overflow-visible">
    <thead>
      <tr>
        <% ["Êó•", "Êúà", "ÁÅ´", "Ê∞¥", "Êú®", "Èáë", "Âúü"].each do |day| %>
          <th class="p-2 bg-gray-200 border text-xs lg:text-sm"><%= day %></th>
        <% end %>
      </tr>
    </thead>

    <tbody>
      <% date = first_day.beginning_of_week %>
      <% end_week = last_day.end_of_week %>

      <% while date <= end_week do %>
        <tr>
          <% 7.times do %>
            <% current = date %>
            <% reminders = @reminder_days[current] || [] %>

            <td class="relative h-14 border align-top p-1
  <%= 'bg-green-200 font-bold' if current == today %>
  <%= 'text-gray-400' if current.month != today.month %>">

  <%= link_to reminders_by_date_path(date: current), class: "absolute inset-0 block p-1" do %>

    <div class="text-xs font-bold">
      <%= current.day %>
    </div>

    <% if reminders.present? %>
      <div class="mt-1">
        <div class="w-5 h-5 bg-yellow-400 text-center text-xs rounded-full mx-auto">
          <%= reminders.count %>
        </div>
      </div>
    <% end %>

    <!-- ÈÄèÊòé„Éú„Çø„É≥ -->
    <%= link_to "",
        reminders_by_date_path(date: current),
        class: "absolute inset-0 block p-1 hover:bg-purple-100 rounded-lg transition" %>

  <% end %>

</td>

            <% date += 1 %>
          <% end %>
        </tr>
      <% end %>
    </tbody>
  </table>
</div>

<script>
function togglePopup(id) {
  const popup = document.getElementById('popup-' + id);
  popup.classList.toggle('hidden');
}
</script>

</div>