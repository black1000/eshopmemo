<div class="mx-auto max-w-screen-xl px-4 sm:px-6 lg:px-8">

<div class="flex items-center justify-between mb-6">
  <h1 class="text-2xl font-bold text-gray-800">
    <%= t('items.reminder.title') %>
  </h1>
  <div class="mt-10">
    <%= link_to t('items.reminder.back_memo'), items_path,
          class: "px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600" %>
  </div>
</div>


<div class="grid grid-cols-1 lg:grid-cols-3 gap-6">

  <div class="lg:col-span-2">
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">

      <% if @reminders.present? %>
        <% @reminders.each do |reminder| %>
          <div class="rounded-xl border border-gray-200 bg-white p-4 shadow hover:shadow-lg transition">

            <div class="flex gap-4">

              <% if reminder.item %>
                <%= link_to item_path(reminder.item), class: "w-32 h-32 flex-shrink-0" do %>
                  <% if reminder.item.image&.attached? %>
                    <%= image_tag url_for(reminder.item.image),
                        class: "rounded-lg w-32 h-32 object-cover" %>
                  <% else %>
                    <%= image_tag "no_image.png",
                        class: "rounded-lg w-32 h-32 object-cover opacity-60" %>
                  <% end %>
                <% end %>
              <% else %>
                <div class="w-32 h-32 bg-gray-200 rounded-lg flex items-center justify-center">
                  <span class="text-gray-500 text-sm">
                    <%= t('items.reminder.no_item') %>
                  </span>
                </div>
              <% end %>

              <!-- ÊÉÖÂ†± -->
              <div class="flex-1">
                <h2 class="text-lg font-semibold text-blue-700 break-words">
                  <% if reminder.item %>
                    <%= link_to (reminder.item.title || t('items.reminder.no_title')), item_path(reminder.item), class: "hover:underline" %>
                  <% else %>
                    (<%= t('items.reminder.no_item') %>)
                  <% end %>
                </h2>

                <p class="text-sm text-gray-600 mt-1">
                  üìÖ <%= reminder.scheduled_date&.strftime("%Y-%m-%d") || t('items.reminder.no_date') %>
                </p>

                <p class="text-sm text-gray-700 mt-1">
                  <%= t('items.reminder.memo') %>Ôºö<%= reminder.memo.presence || t('items.reminder.no_memo') %>
                </p>

                <div class="mt-2">
                  <%= link_to t('items.reminder.detail'), item_path(reminder.item),
                    class: "text-sm text-gray-500 hover:text-gray-700 underline" %>
                </div>

              </div>
            </div>

          </div>
        <% end %>
      <% else %>
        <p class="text-gray-600 text-center mt-8 col-span-2">
          „Åæ„Å†‰∫àÂÆö„ÅåÁôªÈå≤„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇ
        </p>
      <% end %>
    </div>

    <!-- „Éö„Éº„Ç∏„Éç„Éº„Ç∑„Éß„É≥ -->
    <div class="mt-6">
      <%= paginate @reminders %>
    </div>
  </div>

  <!-- „Ç´„É¨„É≥„ÉÄ„Éº-->
  <div class="lg:col-span-1 flex flex-col gap-4 sticky top-4 h-fit">
  <h2 class="text-2xl font-bold text-gray-800">„Ç´„É¨„É≥„ÉÄ„Éº</h2>

  <% today = Date.current %>
  <% first_day = today.beginning_of_month %>
  <% last_day = today.end_of_month %>

  <table class="w-full border-collapse text-sm table-fixed bg-white rounded-lg shadow overflow-visible">
    <thead>
      <tr>
        <% ["Êó•", "Êúà", "ÁÅ´", "Ê∞¥", "Êú®", "Èáë", "Âúü"].each do |day| %>
          <th class="p-2 bg-gray-200 border text-xs lg:text-sm"><%= day %></th>
        <% end %>
      </tr>
    </thead>

    <tbody>
      <% date = first_day.beginning_of_week %>
      <% end_week = last_day.end_of_week %>

      <% while date <= end_week do %>
        <tr>
          <% 7.times do %>
            <% current = date %>
            <% reminders = @reminder_days[current] || [] %>

            <td class="relative h-14 border align-top p-1
  <%= 'bg-green-200 font-bold' if current == today %>
  <%= 'text-gray-400' if current.month != today.month %>">

  <%= link_to reminders_by_date_path(date: current), class: "absolute inset-0 block p-1" do %>

    <div class="text-xs font-bold">
      <%= current.day %>
    </div>

    <% if reminders.present? %>
      <div class="mt-1">
        <div class="w-5 h-5 bg-yellow-400 text-center text-xs rounded-full mx-auto">
          <%= reminders.count %>
        </div>
      </div>
    <% end %>

    <!-- ÈÄèÊòé„Éú„Çø„É≥ -->
    <%= link_to "",
        reminders_by_date_path(date: current),
        class: "absolute inset-0 block p-1 hover:bg-purple-100 rounded-lg transition" %>

  <% end %>

</td>

            <% date += 1 %>
          <% end %>
        </tr>
      <% end %>
    </tbody>
  </table>

  <!-- Ê•ΩÂ§©„Ç¢„Éï„Ç£„É™„Ç®„Ç§„ÉàÂ∫ÉÂëä -->
  <div class="mt-4 flex justify-center">
    <a href="https://hb.afl.rakuten.co.jp/hsc/4e5f6b09.a8c44bc4.4e5e0f94.70024a82/?link_type=pict&ut=eyJwYWdlIjoic2hvcCIsInR5cGUiOiJwaWN0IiwiY29sIjoxLCJjYXQiOiI1OCIsImJhbiI6MzIzMzE4MCwiYW1wIjpmYWxzZX0%3D" target="_blank" rel="nofollow sponsored noopener" style="word-wrap:break-word;"><img src="https://hbb.afl.rakuten.co.jp/hsb/4e5f6b09.a8c44bc4.4e5e0f94.70024a82/?me_id=1&me_adv_id=3233180&t=pict" border="0" style="margin:2px" alt="" title=""></a>
  </div>

  <div class="mt-4 flex justify-center">
    <%= raw('<a href="https://hb.afl.rakuten.co.jp/hsc/4e5e102d.61c9d095.4e5e0f94.70024a82/?link_type=pict&ut=eyJwYWdlIjoic2hvcCIsInR5cGUiOiJwaWN0IiwiY29sIjoxLCJjYXQiOiI0NCIsImJhbiI6Mjc5NDg4OSwiYW1wIjpmYWxzZX0%3D" target="_blank" rel="nofollow sponsored noopener" style="word-wrap:break-word;"><img src="https://hbb.afl.rakuten.co.jp/hsb/4e5e102d.61c9d095.4e5e0f94.70024a82/?me_id=1&me_adv_id=2794889&t=pict" border="0" style="margin:2px" alt="" title=""></a>') %>
  </div>

</div>

<script>
function togglePopup(id) {
  const popup = document.getElementById('popup-' + id);
  popup.classList.toggle('hidden');
}
</script>

</div>
</div>